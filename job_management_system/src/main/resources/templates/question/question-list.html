<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{fragments/home}" lang="vi">
<head>
	<meta charset="UTF-8"/>
	<title layout:title="Quản lý câu hỏi">Quản lý Câu hỏi</title>
</head>
<body class="bg-light">
<section layout:fragment="content">
	<div class="container mt-3">

		<!-- Alerts -->
		<div th:if="${param.success}" class="alert alert-success alert-dismissible fade show" role="alert">
			Đã tạo câu hỏi thành công.
			<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
		</div>
		<div th:if="${param.updated}" class="alert alert-info alert-dismissible fade show" role="alert">
			Đã cập nhật câu hỏi.
			<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
		</div>
		<div th:if="${param.deleted}" class="alert alert-warning alert-dismissible fade show" role="alert">
			Đã xóa câu hỏi.
			<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
		</div>

		<div class="d-flex justify-content-between align-items-center mb-3">
			<h3 class="mb-0">Quản lý Câu hỏi</h3>
			<a th:href="@{/questions/create}" class="btn btn-primary">
				<i class="bi bi-plus-circle me-1"></i> Thêm câu hỏi
			</a>
		</div>

		<form th:action="@{/questions}" method="get" class="row g-2 align-items-end mb-3">
			<div class="col-md-6">
				<label for="keyword" class="form-label">Tìm kiếm</label>
				<div class="input-group">
					<input type="text" id="keyword" name="keyword" th:value="${keyword}" class="form-control" placeholder="Nhập nội dung câu hỏi...">
					<button type="submit" class="btn btn-outline-primary">
						<i class="bi bi-search"></i> Tìm
					</button>
					<a th:href="@{/questions}" class="btn btn-outline-secondary">
						<i class="bi bi-x-circle"></i> Xóa lọc
					</a>
				</div>
			</div>
		</form>

		<div class="card shadow-sm">
			<div class="table-responsive">
				<table class="table table-hover table-striped mb-0">
					<thead class="table-light">
					<tr>
						<th style="width: 80px;">ID</th>
						<th>Nội dung</th>
						<th style="width: 160px;">Loại</th>
						<th style="width: 220px;">Đáp án đúng</th>
						<th style="width: 160px;" class="text-end">Hành động</th>
					</tr>
					</thead>
					<tbody>
					<tr th:each="q : ${questionPage.content}">
						<td th:text="${q.id}">1</td>
						<td>
							<div class="text-truncate" style="max-width: 520px;" th:text="${q.questionText}">Nội dung</div>
						</td>
						<td>
							<span class="badge" th:classappend="${#strings.equalsIgnoreCase(q.questionType,'MULTIPLE_CHOICE') ? ' text-bg-primary' : (#strings.equalsIgnoreCase(q.questionType,'CODING') ? ' text-bg-dark' : (#strings.equalsIgnoreCase(q.questionType,'ESSAY') ? ' text-bg-info' : ' text-bg-secondary'))}"
								  th:text="${q.questionType != null ? q.questionType : 'N/A'}">TEXT</span>
						</td>
						<td>
							<div class="text-truncate" style="max-width: 220px;" th:text="${q.correctAnswer != null ? q.correctAnswer : '-'}">-</div>
						</td>
						<td class="text-end">
							<a th:href="@{'/questions/edit/' + ${q.id}}" class="btn btn-sm btn-outline-secondary">
								<i class="bi bi-pencil-square"></i> Sửa
							</a>
							<form th:action="@{'/questions/delete/' + ${q.id}}" method="post" class="d-inline"
							      onsubmit="return confirm('Xóa câu hỏi này?');">
								<button type="submit" class="btn btn-sm btn-outline-danger">
									<i class="bi bi-trash"></i> Xóa
								</button>
							</form>
						</td>
					</tr>
					<tr th:if="${#lists.isEmpty(questionPage.content)}">
						<td colspan="5" class="text-center py-4 text-muted">Không có dữ liệu</td>
					</tr>
					</tbody>
				</table>
			</div>

			<div class="card-footer d-flex justify-content-between align-items-center">
				<div>
					Trang <span th:text="${questionPage.number + 1}">1</span>/<span th:text="${questionPage.totalPages}">1</span>
					<span class="ms-2 text-muted">(Tổng: <span th:text="${questionPage.totalElements}">0</span>)</span>
				</div>
				<nav>
					<ul class="pagination mb-0">
						<li class="page-item" th:classappend="${questionPage.first} ? 'disabled'">
							<a class="page-link"
							   th:href="@{/questions(page=${questionPage.number - 1}, size=${size}, keyword=${keyword})}">« Trước</a>
						</li>
						<li class="page-item" th:classappend="${questionPage.last} ? 'disabled'">
							<a class="page-link"
							   th:href="@{/questions(page=${questionPage.number + 1}, size=${size}, keyword=${keyword})}">Sau »</a>
						</li>
					</ul>
				</nav>
			</div>
		</div>
	</div>
</section>
</body>
</html>


